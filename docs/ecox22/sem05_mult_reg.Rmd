---
title: "Семинар 5. Задание."
date: '2022-10-04'
output:  
  html_document:  
    self_contained: no  
    theme: cosmo
    toc: true
    toc_float: true
    toc_collapsed: true
    toc_depth: 2
mainfont: Liberation Serif
monofont: Liberation Mono
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Часть 1. Упражнения

## SW, глава 6, вопрос 6.1
Исследователя интересует, как использование компьютеров в школах влияет на результаты тестов. Используя данные по школьным округам, похожие на те, что были использованы в данной главе, она оценивает регрессию зависимости среднего балла по тесту в округе от количества компьютеров, приходящихся на одного учащегося. Будет ли $\hat \beta_1$ несмещенной оценкой влияния на результаты тестов увеличения числа компьютеров на одного ученика? Почему да или почему нет? Если вы считаете, что оценка $\hat \beta_1$ смещена, будет ли это смещение переоценкой или недооценкой коэффициента? Почему?


## SW, глава 6, вопрос 6.2
Множественная регрессия включает в себя два регрессора: $Y_i = \beta_0 + \beta_1 X_{1i} + \beta_2 X_{2i} + u_i$. Каково ожидаемое изменение $Y$, если $X_1$ увеличивается на 3 единицы и $X_2$ остается неизменной? Каково ожидаемое изменение $Y$, если $X_2$ уменьшается на 5 единиц и $X_1$ остается неизменным? Каково ожидаемое изменение $Y$, если $X_1$ увеличивается на 3 единицы и $X_2$ уменьшается на 5 единиц?


## SW, глава 6, упражение 6.6
Исследователь планирует изучить причинно-следственную связь между числом полицейских и преступностью в округе, используя данные из случайной выборки по округам США. Он планирует построить регрессию уровня преступности в округе в зависимости от числа полицейских (на душу населения) в округе.

а. Объясните, почему в оценках этой регрессии, скорее всего, будет присутствовать смещение из-за пропущенной переменной. Какие переменные вы бы добавили в регрессию для контроля важных пропущенных переменных?

б.  Используйте результаты пункта (a) и выражение для смещения из-за пропущенной переменной в уравнении (6.1), чтобы определить, будет ли в регрессии пере- или недооценено влияние числа полицейских на уровень преступности. (Иными словами, считаете ли вы, что $\hat \beta_1 > \beta_1$ или $\hat \beta_1 < \beta_1$)


## SW, глава 6, упражение 6.8
Рассмотрите критически каждый из предлагаемых ниже планов исследования. Опишите любые проблемы, которые могут возникнуть при проведении исследования, а также способы улучшения имеющихся планов исследования. Обсудите, какие дополнительные данные нужно собрать и соответствующие статистические методы, которые можно использовать для анализа данных.

а. Исследователь хочет выяснить, существует ли дискриминация по половому признаку при установлении заработной платы в крупной аэрокосмической фирме. Чтобы определить потенциальный гендерный разрыв в зарплатах, исследователь собирает данные о зарплате и поле всех инженеров фирмы. Затем исследователь планирует провести тест на равенство средних значений для проверки гипотезы о том, что средняя заработная плата женщин существенно меньше, чем средняя зарплата мужчин.

б. Исследователь хочет выяснить, существует ли постоянное влияние наличия у человека срока тюремного заключения на ставку его заработной платы. Он собирает данные из случайной выборки людей, которые вышли из тюрьмы по крайней мере 15 лет назад. Он также собирает аналогичные данные по случайной выборке людей, которые никогда не сидели в тюрьме. Собранные данные включают информацию о текущей заработной плате каждого человека, образовании, возрасте, этнической принадлежности, поле, стаже (время работы в текущей области), роде занятий и статусе в профсоюзе, а также информацию о том, сидел ли этот человек когда-либо в тюрьме или нет. Исследователь планирует оценить влияние факта лишения свободы на заработную плату, оценив регрессию заработной платы на фиктивную переменную, равную единице, если человек сидел в тюрьме, и нулю — в противном случае, а также на другие факторы, потенциально влияющие на размер заработной платы (образование, стаж, статус в профсоюзе и так далее).


## SW, глава 6, упражение 6.9
Предположим, что $(Y_i , X_{1i} , X_{2i})$ удовлетворяют предположениям из вставки "Основные понятия 6.4". 

Вы заинтересованы в получении оценки коэффициента $\beta_1$, отражающего влияние переменной $X_1$ на $Y$. 

Предположим, что $X_1$ и $X_2$ некоррелированы. 

Вы оцениваете коэффициент $\beta_1$ в регрессии $Y$ на $X_1$ (переменная $X_2$ не входит в регрессию). 
Значит ли это, что полученная оценка будет смещена из-за пропущенной переменной? Объясните.


# Часть 2. Эмпирический пример

Ваша задача --- исследовать ценовую дискриминацию на рынке фастфуда по расе и доходу. 


## Исследовательский вопрос

1. Сформулируйте исследовательский вопрос.

2. Сформулируйте исследовательскую гипотезу

3. Обсудите экономический механизм, который бы ее объяснял.  


## Модель

1. Выпишите модели парной линейной регрессии, который подходят для описания изучаемых взаимосвязей. 

2. Обсудите проблему пропущенных переменных. К каким последствиям она может привести?

3. Обсудите, какие контрольные переменные необходимо включить в модель для решения проблемы пропущенных переменных.

4. Обсудите угрозы внутренней и внешней валидности исследования. 


## Загрузка пакетов

Не забудьте загрузить необходимые пакеты.

```{r, message=FALSE}
library(wooldridge)   # пакет содержит наборы данных, используемые в учебнике Wooldridge
                      # ...самостоятельно выберите пакеты для работы с данными...
library(lmtest)       # тестирование гипотез
library(sandwich)     # робастные стандартные ошибки
library(stargazer) # представление результатов нескольких регрессий в одной таблице
```

## Набор данных

На этом семинаре мы продолжаем работать с данными ["discrim"](https://www.rdocumentation.org/packages/wooldridge/versions/1.4-2/topics/discrim). Фрагмент данных можно загрузить, используя встроенный набор данных пакета [wooldridge](https://www.rdocumentation.org/packages/wooldridge/versions/1.4-2).

```{r}
data("discrim")
```

Изучите загруженные данные. Обсудите, какие переменные лучше всего подходят для ответа на поставленный исследовательский вопрос.

## Предварительная обработка данных

При ознакомлении с данными вы можете заметить, что характеристики заведений фастфуда собирались в две разные волны, в то время как характеристики районов постоянны. Для сопоставимости создайте переменные, равные средним за две волны значениям необходимых переменных. 


## Разведывательный анализ данных

Проведите разведывательный анализ данных: 

1. Постройте таблицу с описательными статистиками основных переменных.

2. Постройте графики, визуализирующие изучаемую взаимосвязь.

3. Можете провести дополнительный разведывательный анализ на свое усмотрение.

## Регрессионный анализ
Проведите регрессионный анализ взаимосвязи между переменными цен на фастфуд и переменными расы и дохода: 

1. Оцените модель парной регрессии, выбрав в качестве зависимой одну из переменных цены, используя функцию `lm()` для оценки. 
2. Рассчитайте робастные стандартные ошибки оценок коэффициентов, используя функцию `coeftest()` из пакета `lmtest` в комбинации с возможностями пакета `sandwich`.

3. Повторите действия для модели множественной линейной регрессии (лучше использовать несколько моделей для сопоставления). 

4. Проинтерпретируйте полученные результаты (особое внимание уделите оценке коэффициента при регрессоре).

5. Сведите результаты оценки всех регрессий в одну таблицу, включая робастные стандартные ошибки. Для этого рекомендуется использовать функцию `modelsummary()` из пакета `modelsummary`. Подробную информацию о работе с пакетом можно найти на [его странице](https://vincentarelbundock.github.io/modelsummary/). Альтернативным вариантом является использование функции `stargazer()` из пакета `stargazer`.

6. Постройте диаграмму рассеяния для отражения ключевой взаимосвязи и нанесите на нее линию значений, предсказанных моделью множественной линейной регрессии. Нанесите на график линию изменения значений зависимой переменной от переменной интереса, зафиксировав значения контрольных переменных. 

7. Повторите все действия, проведя анализ для других переменных цены. 

8. Оформите скрипт R так, чтобы он был понятным и воспроизводимым. 