---
title: "Семинар 13. Задание."
output:  
  html_document:  
    self_contained: no  
    theme: cosmo
    toc: true
    toc_float: true
    toc_collapsed: true
    toc_depth: 2
    css: ../extra.css
mainfont: Liberation Serif
monofont: Liberation Mono
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(AER)
```

# Часть 1. Упражнения и вопросы

## SW, глава 11, вопрос 11.1
Предположим, что линейная вероятностная модель дает предсказанное значение $Y$, равное 1.3. Поясните, почему данное значение не имеет смысла.

## SW, глава 11, вопрос 11.2
В таблице 11.2 оценка коэффициента при переменной `black` равна 0.084 в столбце (1), 0.688 в столбце (2) и 0.389 в столбце (3). Несмотря на эти существенные различия, все модели дают схожие оценки предельной величины влияния расовой принадлежности на вероятность получения отказа в выдаче кредита. Поясните данные результаты.


## SW, глава 11, вопрос 11.6
Используя оценки пробит-модели, представленной в уравнении (11.9), ответьте на следующие вопросы:

а) Афроамериканец с `P/I ratio` = 0.35 подает заявление на получение кредита. Какова вероятность того, что заявление будет отклонено?

б) Предположим, что заявитель снизил свой показатель `P/I ratio` до 0.30. Какой эффект это окажет на вероятность отказа в получении кредита?

в) Ответьте еще раз на вопросы из пунктов (а) и (б) для "белокожего" заявителя.

г) Зависит ли предельный эффект изменения `P/I ratio` на вероятность отказа в получении кредита от расовой принадлежности? Поясните свой ответ.

## SW, глава 11, вопрос 11.7
Повторите упражнение 11.6, используя логит-модель, представленную в уравнении (11.10). Одинаковы ли результаты для логит– и пробит-моделей? Поясните свой ответ.

## W, chapter 17, problem 2
Let grad be a dummy variable for whether a student-athlete at a large university graduates in five years. Let `hsGPA` and `SAT` be high school grade point average and SAT score, respectively. Let study be the number of hours spent per week in an organized study hall. Suppose that, using data on 420 student-athletes, the following logit model is obtained:

\[
\hat P(grad  = 1 | hsGPA, SAT, study) = \Lambda (-0.17 + 0.24 hsGPA + 0.00058 SAT + 0.073 study)
\]

where $\Lambda(z) = exp(z) / [1 + exp(z)]$ is the logit function. Holdinghs `GPA` fixed at 3.0 and `SAT` fixed
at 1200, compute the estimated differencein the graduation probability for someone who spent 10 hours per week in study hall and someone who spent 5 hours per week. 


# Часть 2. Эмпирический пример (по мотивам упражнения SW E11.1)

## Исследовательский вопрос
Ваша задача --- исследовать, действительно ли запрет курения на рабочем месте пубеждает курильщиков избавляться от этой вредной привычки. 

## Загрузка пакетов
Не забудьте загрузить необходимые пакеты.

## Набор данных
В этом задании необходимо оценить влияние запретов на курение на рабочем месте, используя базу данных по 10 тыс. офисным работникам в США в период с 1991 по 1993 год, содержащуюся в файле Smoking. База данных содержит информацию о том, были ли введены по месту работы индивида запреты на курение на рабочем месте, является ли тот или иной индивид курильщиком, а также ряд других индивидуальных характеристик. 

Данные можно загрузить, используя встроенные набор данных пакета [AER](https://rdrr.io/cran/AER/) (используйте набор данных `SmokeBan`). Описание данных доступно по [ссылке](https://rdrr.io/cran/AER/man/SmokeBan.html). 

```{r}
data("SmokeBan")
```


## Разведывательный анализ данных

Проведите разведывательный анализ данных: 

1. Постройте таблицу с описательными статистиками основных переменных.

2. Постройте графики, взаимосвязь между возрастом и курением.

3. Постройте таблицу сопряженности между курением и его запретом на рабочем месте. 

4. При необходимости проведите преобразования переменных. 


## Регрессионный анализ

Проведите регрессионный анализ, используя модели probit и logit: 

1. Оцените коэффициенты в регрессии `smoker` на `ban`. Для оценки рекомендуется использовать функцию `glm()` со следующими аргументами: `glm(..., data = ..., family = binomial(link = "..."), x = TRUE)`.

* Проинтерпретируйте оцененные коэффициенты и их значимость (не забудьте посчитать робастные стандартные ошибки).

* Каков эффект запрета на курение на рабочем месте на вероятность курения для сотрудников? Испльзуйте функцию `margins_summary()`.

2. Добавьте в модель контрольные переменные и оцените коэффициенты в новой модели. 

* Сравните полученные оценки эффекта запретов на курение с ответом, полученным в предыдущем пункте. Предложите причину, основанную на сущности этой регрессии, которая объясняла бы изменение в предполагаемом эффекте запрета на курение между этими пунктами.

* Проинтерпретируйте оцененные коэффициенты и их значимость (не забудьте посчитать робастные стандартные ошибки).

3. Проанализируйте предельные эффекты для модели с контрольными переменными.

* Каков эффект запрета на курение на рабочем месте на вероятность курения для сотрудников, если зафиксировать все переменные на каком-то уровне? Например, рассмотрите индивида мужского пола среднего возраста, который закончил колледж и не является ни афроамериканцем, ни латиноамеринанцем.

* Рассчитайте и покажите на графике, как отличается эффект запрета на курение для людей разного пола, если остальные переменные зафиксированы. 

* Рассчитайте и покажите на графике, как отличается эффект запрета на курение для людей разного возраста, если остальные переменные зафиксированы. 

4. (бонус) Рассчитайте оценки отношения шансов и доверительные интервалы к ним для logit модели c контрольными переменными.