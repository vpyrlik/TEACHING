---
title: "Семинар 4. Задание."
date: '2022-09-27'
output:  
  html_document:  
    self_contained: no  
    theme: cosmo
    toc: true
    toc_float: true
    toc_collapsed: true
    toc_depth: 2
mainfont: Liberation Serif
monofont: Liberation Mono
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Часть 1. Упражнения

## SW, глава 5, упражение 5.1
Предположим, что исследователь, используя данные о размере класса ($CS$) и среднем балле за тест в 100 третьих классах, оценивает МНК-регрессию так:


$\widehat{TestScore} = \underset{(20.4)}{520.4} - \underset{(2.21)}{5.82} \times CS$, $R^2 = 0.08$, $SER = 11.5$.


а. Постройте 95 %-й доверительный интервал для коэффициента наклона регрессии $\beta_1$.

б. Вычислите р-значение для проверки двухсторонней нулевой гипотезы $H_0: \beta_1 = 0$. Отвергнете ли вы нулевую гипотезу на уровне значимости 5%? На уровне значимости 1%?

в. Вычислите р-значение для проверки двусторонней нулевой гипотезы $H_0: \beta_1 = -5.6$. Без дополнительных расчетов определите, содержится ли $-5.6$ в 95%-м доверительном интервале для $\beta_1$.

г. Постройте 99%-й доверительный интервал для $\beta_0$.

## SW, глава 5, упражение 5.2 (а, б+)
Предположим, что исследователь, используя данные о заработной плате 250 случайно выбранных мужчин и 280 случайно выбранных женщин, оценивает МНК-регрессию так:


$\widehat{Wage} = \underset{(0.23)}{12.52} + \underset{(0.36)}{2.12} \times Male$, $R^2 = 0.06$, $SER = 4.2$,


где заработная плата ($Wage$) измеряется в долларах в час, и $Male$ --- бинарная переменная, равная единице для мужчин и нулю для женщин.

Определите гендерный разрыв в заработных платах мужчин и женщин как разность в их средних доходах.

а. Каков предполагаемый гендерный разрыв?

б+. Отличается ли рассчитанный гендерный разрыв значимо от нуля? (Вычислите р-значение для проверки нулевой гипотезы, которая состоит в том, что гендерного разрыва не существует, против разумной односторонней альтернативы). Обсудите, почему в этом случае имеет смысл рассмтаривать одностороннюю альтернативу.

(Бонус: обсудите угрозы внутренней валидности исследования).

## SW, глава 5, упражение 5.3
Предположим, что у нас есть случайная выборка из генеральной совокупности двадцатилетних молодых  людей, состоящая из 200 наблюдений, и известны их рост и вес. Регрессия зависимости веса от роста имеет вид:


$\widehat{Weight} = \underset{(2.15)}{-99.41} + \underset{(0.31)}{3.94} \times Height$, $R^2 = 0.81$, $SER = 10.2$, 

где вес ($Weight$) измеряется в фунтах и рост ($Height$) измеряется в дюймах. Человек растет на 1.5 дюйма в год. Постройте 99%-й доверительный интервал для изменения его веса.


# Часть 2. Эмпирический пример

Ваша задача --- исследовать взаимосвязь между ценами на недвижимость и уровнем преступности. 


## Исследовательский вопрос

1. Сформулируйте исследовательский вопрос.

2. Сформулируйте исследовательскую гипотезу

3. Обсудите экономический механизм, который бы ее объяснял.  


## Модель

1. Выпишите модель парной линейной регрессии, которая подходит для описания изучаемой взаимосвязи. 

2. Обсудите подробно предпосылки, необходимые для оценивания этой модели. 

3. Обсудите угрозы внутренней и внешней валидности исследования. 


## Загрузка пакетов

Не забудьте загрузить необходимые пакеты.

```{r, message=FALSE}
library(wooldridge)   # пакет содержит наборы данных, используемые в учебнике Wooldridge
                      # ...самостоятельно выберите пакеты для работы с данными...
library(lmtest)       # тестирование гипотез
library(sandwich)     # робастные стандартные ошибки
library(modelsummary) # представление результатов нескольких регрессий в одной таблице
```

## Набор данных

На этом семинаре мы продолжаем работать с данными ["hprice2"](https://www.rdocumentation.org/packages/wooldridge/versions/1.4-2/topics/hprice2). Фрагмент данных можно загрузить, используя встроенный набор данных пакета [wooldridge](https://www.rdocumentation.org/packages/wooldridge/versions/1.4-2).

```{r}
data("hprice2")
```

Изучите загруженные данные. Обсудите, какие переменные лучше всего подходят для ответа на поставленный исследовательский вопрос.

## Разведывательный анализ данных

Проведите разведывательный анализ данных: 

1. Постройте таблицу с описательными статистиками основных переменных.

2. Постройте графики, визуализирующие изучаемую взаимосвязь.

3. Можете провести дополнительный разведывательный анализ на свое усмотрение.

## Регрессионный анализ

Проведите регрессионный анализ взаимосвязи между переменными цен на недвижимость и уровнем преступности: 

1. Оцените модель парной регрессии на полной выборке в автоматическом режиме, используя функцию `lm()` для оценки. 

2. Рассчитайте робастные стандартные ошибки оценок коэффициентов, используя функцию `coeftest()` из пакета `lmtest` в комбинации с возможностями пакета `sandwich`.

3. Определите доверительные интервалы для оценок коэффициентов, используя функции `coefci()` или `confint()` (обе --- из пакета `lmtest`) в комбинации с возможностями пакета `sandwich`.

4. Проинтерпретируйте полученные результаты (особое внимание уделите оценке коэффициента при регрессоре).

5. Повторите все действия, проведя анализ на как минимум двух подвыборках для подтверждения устойчивости результатов. 

6. Сведите результаты оценки всех регрессий в одну таблицу, включая робастные стандартные ошибки. Для этого рекомендуется использовать функцию `modelsummary()` из пакета `modelsummary`. Подробную информацию о работе с пакетом можно найти на [его странице](https://vincentarelbundock.github.io/modelsummary/). Альтернативным вариантом является использование функции `stargazer()` из пакета `stargazer`.

7. Проведите в "полуавтоматическом" режиме тестирование гипотезы о коэффициенте наклона против разумной односторонней альтернативы. Рассчитайте необходимую статистику, p-value, границы 95%-ного доверительного интервала. 
8. Оформите скрипт R так, чтобы он был понятным и воспроизводимым. 
