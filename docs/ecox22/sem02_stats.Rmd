---
title: "Семинар 2. Задание."
date: '2022-09-13'
output:  
  html_document:  
    self_contained: no  
    theme: cosmo
    toc: true
    toc_float: true
    toc_collapsed: true
    toc_depth: 2
    css: ../extra.css
mainfont: Liberation Serif
monofont: Liberation Mono
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Часть 1. Повторение математической статистики, принцип аналогии

## HS, 6.23, Ex. 6.9 (a, b)

Propose estimators for

(a) $\theta = exp(E[X])$.

(b) $\theta = log(E[exp(X)])$.


## HS, 7.15,  Ex. 7.9

Show that the bias-corrected variance estimator $s^2$ is consistent for the population variance $\sigma^2$.

## HS, 8.16, Ex. 8.1

Let $X$ be distributed Bernoulli $P [X = 1] = p$ and $P [X = 0] = 1 − p$.

(a) Show that $p = E[X]$.

(b) Write down the moment estimator $\hat p$ of $p$.

(c) Find $var(\hat p)$.

(d) Find the asymptotic distribution of $\sqrt n (\hat p - p)$ as $n \rightarrow \infty$.

## HS, 13.19, Ex. 13.5 +

Take the model $X \sim N(\mu, \sigma^2)$. Propose a test for $H_0: \mu = 1$ against $H_1: \mu \neq 1$.

(*) Propose a test for the case of unknown distribution of $X$.

## HS, 13.19, Ex. 13.6 (a, d) +

Test the following hypotheses against two-sided alternatives using the given information. In the following, $\bar X_n$ is the sample mean, $s(\bar X_n)$ is its standard error, $s^2$ is the sample variance, $n$ the sample size, and $\mu = E[X]$.

(a) $H_0 : \mu = 0$, $\bar X_n = 1.2$, $s (\bar X_n) = 0.4$.

(d) $H_0 : \mu = 1$, $\bar X_n = 0.4$, $s^2 = 100$, $n = 1000$.

(*) Construct confidence intervals for both cases.


# Часть 2. Тестирование гипотез в R (и не только)

## Исследовательский вопрос

В этой части семинара мы попытаемся с помощью данных ответить на следующий исследовательский вопрос: *существует ли на рынке труда "gender gap" в зарплате?*


## Загрузка пакетов

Основные команды, необходимые для тестирования гипотез, входят в пакет `stats`, которые устанавливается по умолчанию, поэтому специально что-то ставить необязательно. Однако для предварительной обработки и визуализации данных, а также для удобства представления результатов тестов рекомендуется загрузить дополнительные пакеты. 

```{r, message=FALSE}
library(AER)     # пакет содержит наборы данных, используемые в учебнике Стока и Уотсона
library(dplyr)   # манипуляции с данными
library(tidyr)   # манипуляции с данными
library(ggplot2) # визуализация данных
library(psych)   # описательные статистики
library(broom)   # удобное представление результатов тестов
```

## Загрузка данных

На этом семинаре мы продолжаем работать с данными [Current Population Survey (CPS)](https://en.wikipedia.org/wiki/Current_Population_Survey). Фрагмент данных загружаем, используя встроенный набор данных пакета [AER](https://rdrr.io/cran/AER/man/CPSSW.html) (используйте набор данных `CPSSWEducation`).

```{r}
data("CPSSWEducation")
```

## Разведывательный анализ

### Первичное ознакомление с данными

Вспомните, что содержится в наборе данных, используя команды, которые вы изучили на прошлом семинаре.

### Графический анализ

Постройте графики, описывающие данные. Используйте команды, которые вы изучили в прошлом семинаре. В контексте изучаемого исследовательского вопроса особенно важно строить графики в разрезе переменной пола. 

### Описательные статистики

Вы можете вывести таблицы с описательными статистиками, используя команды, которые вы изучили на прошлом семинаре. Особенно важно посмотреть и сравнить статистики в разрезе переменной пола. 

Если команды, изученные на прошлом семинаре, показались вам слишком сложными, можно использовать команды `describe()`, `describeBy()` из пакета `psych`. 


```{r}
describe(CPSSWEducation, skew = FALSE)
```

```{r}
describeBy(CPSSWEducation, group = CPSSWEducation$gender, skew = FALSE)
```


## Тестирование гипотезы о средней зарплате

Проверьте гипотезу о том, что средняя зарплата в генеральной совокупности равна 17.1.

Обсудите предварительно, какой именно тест надо проводить. Выпишите гипотезы в явном виде. 

### Вручную / у доски

a. Используя данные из таблиц выше, проверьте вручную гипотезу о том, что средняя зарплата в генеральной совокупности равна 17.1, против двустронней альтенативы. 

  * Рассчитайте необходимую статистику и 95%-ный доверительный интервал.

  * Сделайте выводы на уровне значимости 1, 5, 10 %.

b. Проверьте эту же гипотезу против каждой из односторонних альтернатив.

### В полуавтоматическом режиме в R

Используя загруженный набор данных, рассчитайте значения необходимых показателей для проведения тестов и повторите задания из предыдущего пункта. Дополнительно рассчитайте p-value для каждого теста. 

Для того, чтобы вспомнить, как получить характеристики нормального распределения, см. `?Normal`. 

### В автоматическом режиме с использованием функций R

Проведите тест автоматически, используя специальные функции R.

Для проведения t-теста в R есть функция `t.test`. Ее применение может быть реализовано различными способами. Особенности функции можно посмотреть при помощи команд `help("t.test")` или `?t.test`.

Например, простой тест гипотезы о среднем с использованием интерфейса формулы может быть проведен вот так: 

```{r}
t.test(earnings ~ 1, mu = 17.1, data = CPSSWEducation)
```

При помощи функции `tidy()` из пакета `broom` результаты теста можно представить в одной таблицы.

```{r}
t.test(earnings ~ 1, mu = 17.1, data = CPSSWEducation) %>% tidy()
```

Модифицируйте команду так, чтобы проверялась нулевая гипотеза против каждой из односторонних альтернатив. 

```{r}
# здесь мог бы быть ваш код
```



## Тестирование гипотезы о равенстве средних

Проверьте гипотезу о наличии "gender gap".

Обсудите предварительно, какой именно тест надо проводить. Выпишите гипотезы в явном виде. 


### Вручную / у доски

a. Используя данные из таблиц выше, проверьте вручную гипотезу о том, что средняя зарплата в генеральной совокупности равна 17.1, против двустронней альтенативы. 

  * Рассчитайте необходимую статистику и 95%-ный доверительный интервал.

  * Сделайте выводы на уровне значимости 1, 5, 10 %.

b. Проверьте эту же гипотезу против осмысленной односторонней альтернативы.


### В полуавтоматическом режиме в R

Используя загруженный набор данных, рассчитайте значения необходимых показателей для проведения тестов и повторите задания из предыдущего пункта. Дополнительно рассчитайте p-value для каждого теста. 


### В автоматическом режиме с использованием функций R

Проведите тест автоматически, используя специальные функции R.



